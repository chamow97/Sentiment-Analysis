{% extends 'base.html' %}
{% load static %}
{% block active1 %}
    active
{% endblock %}
{% block content %}
    <div>
        <img id="fullScreen" src="{% static 'assets/loading1.gif' %}">
        <div class="col col-xs-3 col-sm-3 col-md-2 col-lg-2">
            </div>
        <h5 class="searchResults">Search results for {{ searchTerm }} :</h5>
        <br><br>
        <center>
            <a href="../search" class="btn btn-primary">Search Again</a>
        </center>
            <br>    <br>
    <br>
    <br>
        <div class="map-areas">
            <br>
            <br>
            <br>
            <br>
        <div class="chart-container">
            <div id="canvas-holder">
		        <canvas style="margin-left: 40px;" id="chart-area"></canvas>
	        </div>
        </div>
        <div class="chart-container">
            <canvas id="sentiment-bar-chart"></canvas>
        </div>
        <br>
        <br><br>
        <br><br>
        <br><br>
        <br>

        <div style="background-color: #FFF;margin-left: 250px; width: 560px; height: 450px; border-radius: 8px; margin-top: 400px;" class="chart-container">
            <div id="india-map" class="imageWrapper">
            </div>
            <br>
            <br>
            <img class="legends" src="{% static 'assets/images/maps/legend.png' %}">
        </div>

        <div class="chart-container" style="position: absolute; display: block; margin-top: 200px">
		    <canvas style="display: block; width: 404px; height: 236px; margin-left:300px" id="canvas"></canvas>
        </div>
            <br>
            <br><br>
            <br><br>
            <br>
            <div style="color: black;" class="twitterContainer positive" id = "positiveTweetContents">
                <h4 style="color: #4CD900; font-size: 30px;">Positive Tweets</h4>
                <br>
            </div>
            <br>
            <br>
            <br>
            <div class="negative" style="color: black;" id = "negativeTweetContents">
                <h4 style="color: #FF0000; font-size: 30px;">Negative Tweets</h4>
                <br>
            </div>
        </div>
    </div>
            <script>
                var positiveTweetContent = document.getElementById("positiveTweetContents");
                var negativeTweetContent = document.getElementById("negativeTweetContents");
                var maps = [];
                jQuery.ajaxSetup({async:false});
                {#$.ajax({#}
                {#     url: 'http://192.168.1.100:5000/retrieve',#}
                {#     type: 'POST',#}
                {#     contentType: "application/json",#}
                {#     dataType: "json",#}
                {#     data: JSON.stringify({"key": "cambridge"}),#}
                {#     success: function (data) {#}
                {#        $("#fullScreen").hide();#}
                {#         maps = data;#}
                {#         console.log(maps);#}
                {#         generateAll();#}
                {#     }#}
                {# });#}
                maps = {"contents": {"total_sentiment": {"neg": 291, "neu": 508, "pos": 182}, "timeline": {"neg": {"2018-03-31 04:00:00": 99, "2018-03-31 03:00:00": 94, "2018-03-31 02:00:00": 98}, "neu": {"2018-03-31 04:00:00": 137, "2018-03-31 03:00:00": 221, "2018-03-31 02:00:00": 150}, "pos": {"2018-03-31 04:00:00": 48, "2018-03-31 03:00:00": 72, "2018-03-31 02:00:00": 62}}, "gender_details": {"M": {"neg": 201, "neu": 338, "pos": 139}, "F": {"neg": 90, "neu": 170, "pos": 43}}, "noun_based_importance": {}, "important_tweets": {"neg": [{"original_text": "Alleging 'Very Serious' Violations, Groups File Complaint Against John Bolton Super PAC Over Ties to Cambridge Analytica || via; Commondreams https://t.co/MPNcumQcN4", "text": "Alleging 'Very Serious' Violations, Groups File Complaint Against John Bolton Super PAC Over Ties to Cambridge Analytica || via; Commondreams "}, {"original_text": "We lost the data wars even before #CambridgeAnalytica : I write in @washingtonpost - the quarrel between BJP &amp; Congress is just noise. We are complicit in the invasion of our Privacy. Culturally we are exhibitionists; Professionally digital salespersons https://t.co/lIa8DrVTeZ", "text": "We lost the data wars even before #CambridgeAnalytica : I write in @washingtonpost - the quarrel between BJP &amp; Congress is just noise. We are complicit in the invasion of our Privacy. Culturally we are exhibitionists; Professionally digital salespersons "}, {"original_text": "As journalists we have lived with three hegemonies: the Tyranny of the State ( when governments controlled Media); the Tyranny of the Market ( supplicant to ad revenue) &amp; now the third- the Tyranny of the Algorithm! I write in @washingtonpost on data wars https://t.co/lIa8DrVTeZ", "text": "As journalists we have lived with three hegemonies: the Tyranny of the State ( when governments controlled Media); the Tyranny of the Market ( supplicant to ad revenue) &amp; now the third- the Tyranny of the Algorithm! I write in @washingtonpost on data wars "}, {"original_text": "Prof Stephen Hawking Cambridge funeral to take place https://t.co/FmrSbCbJ5R", "text": "Prof Stephen Hawking Cambridge funeral to take place "}, {"original_text": "@realDonaldTrump \\u2018Cambridge Analytica and Online Manipulation\\u2019\\n\\n\\u2018It's not just about data protection; it's about strategies designed to induce addictive behavior, and thus to manipulate\\u2019  \\n\\nhttps://t.co/yWfTloW0Ot", "text": "@realDonaldTrump Analytica and Online Manipulation not just about data protection; it's about strategies designed to induce addictive behavior, and thus to manipulate "}], "neu": [{"original_text": "The question remains whether the kind of targeting allegedly done by Cambridge Analytica on behalf of Donald Trump\\u2019s campaign can actually influence people\\u2019s behavior. https://t.co/qbxAC1dt3L", "text": "The question remains whether the kind of targeting allegedly done by Cambridge Analytica on behalf of Donald Trump campaign can actually influence people behavior. "}, {"original_text": "Cambridge Analytica's Fossil Fuel Connections - Several key directors at CA/SCL Group have direct connections to the fossil fuel industry, records show, by @NafeezAhmed https://t.co/mYreBElgA6", "text": "Cambridge Analytica's Fossil Fuel Connections - Several key directors at CA/SCL Group have direct connections to the fossil fuel industry, records show, by @NafeezAhmed "}, {"original_text": "Thousands of people are expected to arrive in #Cambridge for the #funeral of British #physicist #StephenHawking.\\n\\nhttps://t.co/nah6aHilbv", "text": "Thousands of people are expected to arrive in #Cambridge for the #funeral of British #physicist #StephenHawking. "}, {"original_text": "Here's how Cambridge Analytica sold itself to clients AFTER the election. See the document for yourself. https://t.co/EWHkYcpApv", "text": "Here's how Cambridge Analytica sold itself to clients AFTER the election. See the document for yourself. "}, {"original_text": "De acuerdo con el Comit\\xe9 Ejecutivo Nacional del @PRI_Nacional, ellos jam\\xe1s han celebrado contratos con Cambridge Analytica. https://t.co/1Wuu9jHOrK", "text": "According to the National Executive Committee of @PRI_Nacional, they have never entered into contracts with Cambridge Analytica."}], "pos": [{"original_text": "@AynRandPaulRyan @SaysHummingbird @mystcole @lena_eisen @TXWomenRising @TXElects @1Jedi_Rey @CaptainsLog2O18 @captDameron2018 @TopRopeTravis @TwoBroadsTalk @DeepInTheHills @joncoopertweets @jomareewade @DMansini @ekcj1234 @ifindkarma @eorlins @HeatherWhaley @tarastrong @Alyssa_Milano @TheLoveBel0w @B52Malmet The Cambridge Analytica revelations really drive home the need for the FCC to demand that outside political money groups disclose the *names of their major donors* funding their ads. That goes for Facebook ads - and Amy Klobuchar has a great bill that does just that. \\n\\n3/", "text": "@AynRandPaulRyan @SaysHummingbird @mystcole @lena_eisen @TXWomenRising @TXElects @1Jedi_Rey @CaptainsLog2O18 @captDameron2018 @TopRopeTravis @TwoBroadsTalk @DeepInTheHills @joncoopertweets @jomareewade @DMansini @ekcj1234 @ifindkarma @eorlins @HeatherWhaley @tarastrong @Alyssa_Milano @TheLoveBel0w @B52Malmet The Cambridge Analytica revelations really drive home the need for the FCC to demand that outside political money groups disclose the *names of their major donors* funding their ads. That goes for Facebook ads - and Amy Klobuchar has a great bill that does just that. 3/"}, {"original_text": "Thousands expected at Professor #StephenHawking's funeral at Great St. Mary's Church in Cambridge https://t.co/svpwS2YJaS https://t.co/g8T4PdMdAG", "text": "Thousands expected at Professor #StephenHawking's funeral at Great St. Mary's Church in Cambridge "}, {"original_text": "Friends, family and colleagues of Stephen Hawking will gather to pay their respects at a private funeral in Cambridge, where he spent most of his extraordinary life https://t.co/AVATJNfeiu https://t.co/Eg7oR1oDvo", "text": "Friends, family and colleagues of Stephen Hawking will gather to pay their respects at a private funeral in Cambridge, where he spent most of his extraordinary life "}, {"original_text": "@realDonaldTrump \\u2018Wiley reveals work the Trump data firm did for a Russian oil company with ties to Kremlin intelligence, was \\u201cconcerning\\u201d and that they could be aware of a \\u201cmassive data set being harvested on Americans\\u201d\\n(Video) https://t.co/0ko74Aj0Ju", "text": "@realDonaldTrump reveals work the Trump data firm did for a Russian oil company with ties to Kremlin intelligence, was and that they could be aware of a data set being harvested on Americans "}, {"original_text": "When users click OK to Manorama Online and Mathrubhumi News app, do they realize what they are giving up? https://t.co/PfeoQxhpvN Is Effective Measure another Cambridge Analytica? @Swamy39  @mohandastg", "text": "When users click OK to Manorama Online and Mathrubhumi News app, do they realize what they are giving up? Is Effective Measure another Cambridge Analytica? @Swamy39 @mohandastg"}]}, "geographic_sentiments": {"Pondicherry": {"neg": 0, "neu": 0, "pos": 0}, "Haryana": {"neg": 9, "neu": 17, "pos": 6}, "Punjab": {"neg": 1, "neu": 2, "pos": 1}, "Goa": {"neg": 0, "neu": 1, "pos": 1}, "Chhattisgarh": {"neg": 0, "neu": 0, "pos": 0}, "Kerala": {"neg": 3, "neu": 5, "pos": 1}, "Daman and Diu": {"neg": 0, "neu": 0, "pos": 0}, "Andaman and Nicobar": {"neg": 0, "neu": 0, "pos": 0}, "Bihar": {"neg": 0, "neu": 2, "pos": 2}, "Tamil Nadu": {"neg": 5, "neu": 13, "pos": 1}, "Jammu and Kashmir": {"neg": 0, "neu": 0, "pos": 0}, "Madhya Pradesh": {"neg": 0, "neu": 2, "pos": 0}, "Jharkhand": {"neg": 1, "neu": 0, "pos": 0}, "Meghalaya": {"neg": 0, "neu": 0, "pos": 0}, "Delhi": {"neg": 3, "neu": 4, "pos": 0}, "Orissa": {"neg": 0, "neu": 0, "pos": 0}, "Assam": {"neg": 0, "neu": 1, "pos": 0}, "Dadra and Nagar Haveli": {"neg": 0, "neu": 0, "pos": 0}, "Lakshadweep": {"neg": 0, "neu": 1, "pos": 0}, "West Bengal": {"neg": 0, "neu": 3, "pos": 0}, "Rajasthan": {"neg": 3, "neu": 5, "pos": 5}, "Uttar Pradesh": {"neg": 11, "neu": 40, "pos": 3}, "Manipur": {"neg": 0, "neu": 0, "pos": 0}, "Uttarakhand": {"neg": 0, "neu": 0, "pos": 0}, "Andhra Pradesh": {"neg": 84, "neu": 124, "pos": 51}, "Himachal Pradesh": {"neg": 0, "neu": 0, "pos": 0}, "Others": {"neg": 152, "neu": 259, "pos": 89}, "Nagaland": {"neg": 0, "neu": 0, "pos": 0}, "Gujarat": {"neg": 0, "neu": 1, "pos": 3}, "Arunachal Pradesh": {"neg": 0, "neu": 1, "pos": 0}, "Maharashtra": {"neg": 13, "neu": 21, "pos": 11}, "Tripura": {"neg": 0, "neu": 0, "pos": 0}, "Telangana": {"neg": 2, "neu": 1, "pos": 0}, "Karnataka": {"neg": 4, "neu": 5, "pos": 8}, "Mizoram": {"neg": 0, "neu": 0, "pos": 0}, "Sikkim": {"neg": 0, "neu": 0, "pos": 0}}, "ethnicity": {"Hindu": {"neg": 59, "neu": 71, "pos": 29}, "Muslim": {"neg": 11, "neu": 20, "pos": 5}, "Christian": {"neg": 221, "neu": 417, "pos": 148}}}};
                generateAll();
                function generateAll(){
                {% static "" as baseUrl %}
                var states = [];
                var positiveTimeline = [], negativeTimeline = [], neutralTimeline = [], totalTimeline = [];
                for(var row in maps["contents"]["timeline"]){
                    for(var timeline in maps["contents"]["timeline"][row]){
                        if(row === "pos"){

                            positiveTimeline.push(maps["contents"]["timeline"][row][timeline]);
                            totalTimeline.push(timeline);

                        }
                        else if(row === "neg"){
                            negativeTimeline.push(maps["contents"]["timeline"][row][timeline]);
                        }
                        else if(row === "neu"){
                            neutralTimeline.push(maps["contents"]["timeline"][row][timeline]);
                        }


                    }
                }
                totalTimeline.sort();

                var lineChartData = {
                    labels: totalTimeline,
                    datasets: [{
                        label: 'Positive',
                        borderColor: "#4CD900",
                        backgroundColor: "#4CD900",
                        fill: false,
                        data: positiveTimeline,
                        yAxisID: 'y-axis-1',
                    }, {
                        label: 'Negative',
                        borderColor: window.chartColors.red,
                        backgroundColor: window.chartColors.red,
                        fill: false,
                        data: negativeTimeline,
                        yAxisID: 'y-axis-2'
                    },
                        {
                            label: 'Neutral',
                            borderColor: window.chartColors.blue,
                            backgroundColor: window.chartColors.blue,
                            fill: false,
                            data: neutralTimeline,
                            yAxisID: 'y-axis-3'
                        }]
                };
                for(var row in maps["contents"]["geographic_sentiments"]){
                    if(row == "Others" || row == "Lakshadweep" || row == "Dadra and Nagar Haveli"
                        || row == "Andaman and Nicobar" || row == "Daman and Diu" || row == "Pondicherry"){
                        continue;
                    }
                    states.push(row);
                }
                var path = "assets/images/maps/";
                states.forEach(function(value, index){
                    var randomVal = Math.floor(Math.random() * 4);
                    var mapColor;
                    var maxCount = Math.max(maps["contents"]["geographic_sentiments"][value]["pos"],
                        maps["contents"]["geographic_sentiments"][value]["neg"],
                        maps["contents"]["geographic_sentiments"][value]["neu"]);
                    if(maxCount === 0){
                        mapColor = "grey";
                    }
                    else if(maxCount === maps["contents"]["geographic_sentiments"][value]["pos"]){
                        mapColor = "green";
                    }
                    else if(maxCount === maps["contents"]["geographic_sentiments"][value]["neg"]){
                        mapColor = "red";
                    }
                    else if(maxCount === maps["contents"]["geographic_sentiments"][value]["neu"]){
                        mapColor = "blue";
                    }
                    else{
                        mapColor = "grey";
                    }
                    var temp = '';
                    temp += value;
                    temp += '/';
                    temp += (value + '_' + mapColor + '.png');
                    temp = path + temp;
                    var currentElement = "";
                    currentElement += "<img class='overlayImage' src='{{ baseUrl }}";
                    currentElement += temp;
                    currentElement += " ' >";
                    document.getElementById("india-map").innerHTML += currentElement;
                });

                var totalTweetCount = 0;
                var negativeTweetCount, positiveTweetCount, neutralTweetCount;
                positiveTweetCount = 0;
                for (var row in maps["contents"]["timeline"]["pos"]) {
                    positiveTweetCount = parseInt(maps["contents"]["timeline"]["pos"][row]) + positiveTweetCount;
                }
                negativeTweetCount = 0;
                for (var row in maps["contents"]["timeline"]["neg"]) {
                    negativeTweetCount = parseInt(maps["contents"]["timeline"]["neg"][row]) + negativeTweetCount;
                }
                neutralTweetCount = 0;
                for (var row in maps["contents"]["timeline"]["neu"]) {
                    neutralTweetCount = parseInt(maps["contents"]["timeline"]["neu"][row]) + neutralTweetCount;
                }
                totalTweetCount = 0;
                totalTweetCount = positiveTweetCount + neutralTweetCount + negativeTweetCount;
                positivePercent = Math.round(((parseFloat(positiveTweetCount / totalTweetCount)) * 100) * 100) / 100;
                negativePercent = Math.round(((parseFloat(negativeTweetCount / totalTweetCount)) * 100) * 100) / 100;
                neutralPercent = Math.round(parseFloat(100 - positivePercent - negativePercent) * 100) / 100;
                var dataPercent = [];
                dataPercent.push(positivePercent);
                dataPercent.push(negativePercent);
                dataPercent.push(neutralPercent);
                var config = {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: dataPercent,
                            backgroundColor: ["#4CD900", "#FF0000", "#007AFF"

                            ],
                            label: 'Sentiment Analysis'
                        }],
                        labels: [
                            'Positive',
                            'Negative',
                            'Neutral'
                        ]
                    },
                    options: {
                        responsive: true,
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Sentiment Analysis'
                        },
                        tooltips: {
                           callbacks: {
                              label: function(tooltipItem, data) {
                                 var label = data.labels[tooltipItem.index];
                                 var _data = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                 var data = /\./.test(_data) ? _data.toFixed(2) : _data;
                                 return label + ' - ' + data + '%';
                              }
                           }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true,
                            duration: 4000
                        }
                    }
                };
                var maleData = [], femaleData = [];
                for(var row in maps["contents"]["gender_details"]["M"]){
                    maleData.push(maps["contents"]["gender_details"]["M"][row]);

                }
                for(var row in maps["contents"]["gender_details"]["F"]){
                    femaleData.push(maps["contents"]["gender_details"]["F"][row]);
                }

                var genders = ["Male", "Female"];
                var color = Chart.helpers.color;
                var barChartData = {
                    labels: ["Male", "Female"],
                    datasets: [
                        {
                            label: "Positive",
                            backgroundColor: "#4CD900",
                            data: [maleData[2], femaleData[2]]
                        },
                        {
                            label: "Negative",
                            backgroundColor: "#FF0000",
                            data: [maleData[0], femaleData[0]]
                        },
                        {
                            label: "Neutral",
                            backgroundColor: "#007AFF",
                            data: [maleData[1], femaleData[1]]
                        }
                    ]
                };

                window.onload = function() {
                    var ctx = document.getElementById('sentiment-bar-chart').getContext('2d');
                    window.myBar = new Chart(ctx, {
                        type: 'bar',
                        data: barChartData,
                        options: {
                            responsive: true,
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Sentiment Analysis'
                            },
                            animation: {
                                duration: 4000,
                                easing: 'linear'
                            }

                        }
                    });
                    var ctx = document.getElementById('chart-area').getContext('2d');
                    window.myDoughnut = new Chart(ctx, config);
                    var ctx = document.getElementById('canvas').getContext('2d');
                    window.myLine = Chart.Line(ctx, {

                        data: lineChartData,
                        options: {
                            responsive: true,
                            hoverMode: 'index',
                            stacked: false,
                            title: {
                                display: true,
                                text: 'Timeline Chart'
                            },
                            scales: {
                                yAxes: [{
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'left',
                                    id: 'y-axis-1',
                                }, {
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'right',
                                    id: 'y-axis-2',

                                    // grid line settings
                                    gridLines: {
                                        drawOnChartArea: false, // only want the grid lines for one axis to show up
                                    }
                                },{
                                    type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
                                    display: true,
                                    position: 'right',
                                    id: 'y-axis-3',

                                    // grid line settings
                                    gridLines: {
                                        drawOnChartArea: false, // only want the grid lines for one axis to show up
                                    },
                                }],
                            },
                            animation: {
                                duration: 4000,
                                easing: 'linear'
                            }
                        }
                    });

                };

                for(var row in maps["contents"]["important_tweets"]["pos"]){
                    var html = "<div class='card'><div class='container'><p>";
                    html += maps["contents"]["important_tweets"]["pos"][row]["original_text"];
                    html += "</p></div><br>";
                    positiveTweetContent.innerHTML += html;
                }
                for(var row in maps["contents"]["important_tweets"]["neg"]){
                    var html = "<div class='card'><div class='container'><p>";
                    html += maps["contents"]["important_tweets"]["neg"][row]["original_text"];
                    html += "</p></div><br>";
                    negativeTweetContent.innerHTML += html;
                }
    }


            </script>
        </div>
        </div>

    </div>
{% endblock %}